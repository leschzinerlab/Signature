# Signature
This repository contains programs to run signature through the command line to pick single particles for electron microscopy.

## Background information

Signature is a particle picking program for electron microscopy images, written and maintained by the Grigorieff Lab at Janelia:

http://grigoriefflab.janelia.org/signature

## Usage

After cloning this repo, you can use the python program *runSignature.py* to display input options:

```
$ Signature/runSignature.py
Usage: runSignature.py -i <input micrograph> -t <template imagic stack> --apixMicro=[pixel size] --apixTemplate=[pixel size] --boxsize=[box] --diam=[particle diameter] --thresh=[threshold] --mirror --bin=<bin> --all='wildcard'

Options:
  -h, --help            show this help message and exit
  -i FILE               Micrograph name
  -t FILE               Stack of particles for template (.img)
  --apixMicro=float     Pixel size of micrograph
  --apixTemplate=float  Pixel size of templates
  --boxsize=int         Box size of templates
  --diam=INT            Particle diameter (Angstroms)
  --thresh=float        Threshold for particle selection (0 - 1)
  --mirror              Flag to mirror input references
  --binning=INT         Binning factor for picking (Default=4)
  --all=STRING          Include wildcard within quotes to loop over all
                        micrographs with that wildcard (e.g. '*en.mrc')
  -d                    debug
```

### Run on single micrograph or group of micrographs

This python wrapper was written to be run on single micrographs OR an entire directory of micrographs. By specifying either input option you will run the program in single micrograph mode or loop mode:

**Single micrograph:**
```
-i {input_micrograph}.mrc
```

**Loop over wildcard specified micrographs**
```
--all='/path/to/micrographs/*.mrc'
```

### Inputs

- This program will take *.mrc* micrograph images to be picked by a particle stack that is provided as a *.img/hed* stack. By using the particle reference stack, signature will pick particles within the micrograph based upon a user-provided threshold.

- By default, each template will be rotated by 15 degree increments, so there is no need to rotate your input templates.

- The template particle stack can have as many images as desired. Usually this template stack is generated from 2D class averages or 2D projections from a 3D model.

- The box size of the input templates will be used within the output *.box* file generated by this program.

- The particle diameter (in Angstroms) is used by signature in selecting the particles from the micrograph

- Typically binning the micrograph by a factor of 4 is sufficient to speed up the picking, while not binning the image so drastically that the program loses its ability to discriminate between different particles.

- The templates can be mirrored, as specified by the *--mirror* option.

### Output

Whether run on a single micrograph or a directory of micrographs, this program will output a text file in *.box* format that has the same basename as the input micrograph. For example, if the input micrograph name is *image001.mrc* then the output file will be *image001.box*.

## Example commands

To run on a single micrograph:

```
$ Signature/runSignature.py -i image001.mrc -t refs.img --apixMicro=2.15 --apixTemplate=4.3 --boxsize=200 --diam=600 --thresh=0.4 --mirror
```

To run over a set of micrographs in a directory:

```
$ Signature/runSignature.py -t refs.img --apixMicro=2.15 --apixTemplate=4.3 --boxsize=200 --diam=600 --thresh=0.4 --mirror --all='*en.mrc'
```
